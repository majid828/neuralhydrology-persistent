# --- Experiment configurations --------------------------------------------------------------------
experiment_name: persistent_hourly_test

run_dir:

train_basin_file: ./test/test_data/4_basins_test_set.txt
validation_basin_file: ./test/test_data/4_basins_test_set.txt
test_basin_file: ./test/test_data/4_basins_test_set.txt

train_start_date: '01/01/2000'
train_end_date: '31/12/2002'
validation_start_date: '01/01/2001'
validation_end_date: '31/12/2002'
test_start_date: '01/01/2001'
test_end_date: '31/12/2002'

seed: 111
device: cpu

# --- Validation configuration ---------------------------------------------------------------------
validate_every: 1
validate_n_random_basins: 4
cache_validation_data: True
metrics:
  - NSE
  - KGE
  - Alpha-NSE
  - Beta-NSE

# --- Model configuration --------------------------------------------------------------------------
model: persistentlstm              # <--- use your new model
head: regression
output_activation: linear

hidden_size: 128
initial_forget_bias: 3
output_dropout: 0.4

# turn on persistent behavior in BaseTrainer
persistent_state: true             # <--- NEW

# --- Training configuration -----------------------------------------------------------------------
optimizer: Adam
loss: MSE
learning_rate:
  0: 1e-3
  10: 5e-4
  20: 1e-4

batch_size: 64                  # smaller is safer for testing
epochs: 15                          # keep small for now while debugging
clip_gradient_norm: 1

# use ALL timesteps in each sequence for the loss
seq_length: 2                    # like your standalone code
predict_last_n: 2                # must equal seq_length

num_workers: 0
log_interval: 5
log_tensorboard: False             # can set True later
log_n_figures: 1
save_weights_every: 1
save_validation_results: False

# --- Data configurations --------------------------------------------------------------------------
dataset: hourly_camels_us          # will be filled by conftest
data_dir: ./test/test_data/camels_us
forcings: nldas_hourly
# will be filled by conftest
dynamic_inputs:                    # will be filled by conftest
  - total_precipitation
  - temperature
target_variables:
  - qobs_mm_per_hour
#static_attributes:  # persistent is not using statistic attributes! so we enable them or disable them it does not effect !! 
 # - elev_mean
  #- slope_mean

# --- Persistent sampling configuration ------------------------------------------------------------
# Non-overlapping windows for persistent LSTM
non_overlapping_sequences: true    # <--- NEW
seq_stride: 2                  # <--- NEW (usually = seq_length)
