# --- Experiment configurations --------------------------------------------------------------------
experiment_name: persistent_hourly_test

# leave empty/null to let NH create runs/<experiment_name>_timestamp automatically
run_dir:

train_basin_file: ./test/test_data/4_basins_test_set.txt
validation_basin_file: ./test/test_data/4_basins_test_set.txt
test_basin_file: ./test/test_data/4_basins_test_set.txt

#train_basin_file: /mnt/disk1/CAMELS_US/basin_lists/list_250_OWP.txt
#validation_basin_file: /mnt/disk1/CAMELS_US/basin_lists/list_250_OWP.txt
#test_basin_file: /mnt/disk1/CAMELS_US/basin_lists/list_250_OWP.txt

train_start_date: '01/01/2000'
train_end_date: '31/12/2001'
validation_start_date: '01/01/2002'
validation_end_date: '30/06/2002'
test_start_date: '01/07/2002'
test_end_date: '31/12/2002'

seed: 111
device: cpu

# --- Validation configuration ---------------------------------------------------------------------
validate_every: 1
validate_n_random_basins: 4
cache_validation_data: True
metrics:
  - NSE
  - KGE
  - Alpha-NSE
  - Beta-NSE

# --- Model configuration --------------------------------------------------------------------------
model: persistentlstm
head: regression
output_activation: linear

hidden_size: 256
initial_forget_bias: 3
output_dropout: 0.3   # reduced (0.4 often hurts)

# --- Persistent LSTM behavior ---------------------------------------------------------------------
# USED by your BaseTrainer to switch to BasinChronoInterleaveBatchSampler + epoch-local state cache
persistent_state: true

nan_handling_method: masked
# --- Evaluation warm-up (spin-up) -----------------------------------------------------------------
eval_warmup_steps: 0

# --- Training configuration -----------------------------------------------------------------------
optimizer: Adam
loss: MSE
learning_rate:
  0: 7e-3
  3: 5e-4
  6: 3e-4
  9: 1e-4
  25: 5e-5
  27: 3e-5
  29: 1e-5

batch_size: 16
epochs: 30
clip_gradient_norm: 1

# IMPORTANT: give the model temporal context
seq_length: &SEQ 4
predict_last_n: *SEQ

num_workers: 0
log_interval: 5
log_tensorboard: False
log_n_figures: 1
save_weights_every: 1
save_validation_results: False

# --- Data configurations --------------------------------------------------------------------------
dataset: hourly_camels_us
data_dir: ./test/test_data/camels_us
forcings: nldas_hourly
dynamic_inputs:
  - total_precipitation
  - temperature
target_variables:
  - qobs_mm_per_hour
static_attributes:
  - elev_mean
  - slope_mean

# --- Persistent sampling configuration ------------------------------------------------------------
# If you want strict non-overlapping time blocks (good for persistent hidden state logic)
non_overlapping_sequences: true
seq_stride: *SEQ
